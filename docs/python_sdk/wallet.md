## **Requirements**

Current version of the python SDK requires:

- running local epic-wallet cli ([github code](https://github.com/EpicCash/epic-wallet), [ executables](https://epic.tech/downloads))
- access to `epic-wallet.toml` configuration file, by default:
=== "Windows"
    ``` 
    %USERPROFILE%\.epic\main\
    ```
=== "Linux"
    ```
    ~\.epic\main\
    ```
- access to epic-server address (local or remote) saved in `epic-wallet.toml` file:
```toml
check_node_api_http_addr = "http://127.0.0.1:3413"
```
- if not using local node, provide valid public remote  epic node API address
- for testing purposes you can use `https://epic-radar.com/node`.
<hr>

## `Wallet` class
- `Wallet` class provides functionality to manage epic cli wallet using python
- Required params are  `api_url` and `api_secret` for `owner_api` calls

- `api_url` is address where epic wallet cli is listening for POST requests
- to run `owner` api methods you have to provide `api_secret` generated by your wallet
<hr>

## **Foreign API** 
The Foreign API contains methods that other wallets will use to interact 
with the owner's wallet. This API can be exposed to the outside world. 
More details about Mimblewimble wallet `foreign_api`: [docs.rs/grin_wallet_api](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.ForeignRpc.html)

- API calls are POST requests send to JSONRPC epic API
- API calls are AUTH with `user` as username and `api_secret` as password 
- default URL: `http://127.0.0.1:3415`

<br>

### Methods

#### check_version()
Return the version capabilities of the running node API, 
more details: [docs.rs/grin_wallet_api/check_version](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.ForeignRpc.html#json-rpc-example)

> Required: `None`

> Returned: `dictionary`

=== "Request"
    ```python
    wallet.check_version()
    ```

=== "Response"
    ```json
    response = {
        "foreign_api_version": 3,
        "supported_slate_versions": [
            "V3",
            "V2"
        ]
    }
    ```

#### build_coinbase()
Builds a new unconfirmed coinbase output in the wallet, 
more details: [docs.rs/grin_wallet_api/build_coinbase](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.ForeignRpc.html#json-rpc-example-1)

> Required: `fees`, `height`

> Returned: `dictionary`

=== "Request"
    ```python
    params = {
        "fees" : 700000,
        "height": 545454,
        "key_id": None
    }
    wallet.build_coinbase(**params)
    ```

=== "Response"
    ```json
    response = {
        "kernel": {
				"excess": "...",
				"excess_sig": "...",
				"features": "Coinbase",
				"fee": "0",
				"lock_height": "0"
			},
			"key_id": "...",
			"output": {
				"commit": "...",
				"features": "Coinbase",
				"proof": "..."
			}
		}
    }
    ```

#### receive_tx()
Recieve a tranaction created by another party,
more details: [docs.rs/grin_wallet_api/receive_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.ForeignRpc.html#json-rpc-example-3)

> Required: `params`

> Returned: `dictionary`

=== "Request"
    ```python
    params = {'transaction_data': {...}}

    wallet.receive_tx(**params)
    ```

=== "Response"
    ```json
    response = {'transaction_data': {...}}
    ```

#### finalize_invoice_tx()
Finalizes an invoice transaction initiated by this wallet's `owner_api`, 
more details: [docs.rs/grin_wallet_api/finalize_invoice_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.ForeignRpc.html#json-rpc-example-4)
> Required: `params`

> Returned: `dictionary`

=== "Request"
    ```python
    params = {'invoice_data': {...}}

    wallet.finalize_invoice_tx(**params)
    ```

=== "Response"
    ```json
    response = {'invoice_data': {...}}
    ```
<hr>

<br>

## **Owner API** 
The Owner API is intended to expose methods that are to be used 
by the wallet owner. It is vital that this API is not exposed 
to anyone other than the owner of the wallet, more details about Mimblewimble wallet `owner_api`: 
[docs.rs/grin_wallet_api](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.OwnerRpcS.html)

- all owner API calls are encrypted with the `AES-256-GMC` cypher
- `secp256k1` ECDH 32bit `encryption_key` is used as encryption seed

<br>

### Workflow
> More details about Mimblewimble wallet lifecycle: [docs.grin.mw](https://docs.grin.mw/grin-rfcs/text/0004-full-wallet-lifecycle/)

1. execute `init_secure_api()` function to generate `encryption_key`
2. execute `open_wallet()` function to generate session `token`
3. perform wallet operations using generated `encryption_key` and `token`
4. execute `close_wallet()` function to close session and remove `token`

```py linenums="1" title="Wallet work-flow"
from v3 import Wallet

API_VER = "v3"
NODE_URL = "http://127.0.0.1:3413"
API_SECRET = "~\.epic\main\.owner_api_secret"
OWNER_API_PORT = 3420

API_URL = f"http://127.0.0.1:{OWNER_API_PORT}/{API_VER}/owner"
USER = 'epic'
PASS = 'YOUR_PASSWORD'

wallet = Wallet(api_url=API_URL, api_user=USER, api_secret=API_SECRET)

wallet.init_secure_api()
wallet.open_wallet()

# Wallet operations here ...

wallet.close_wallet()
```

### Methods
- API calls are POST requests send to JSONRPC epic API
- default URL: `http://127.0.0.1:3420`

<br>

#### init_secure_api()
Initializes the secure JSON-RPC API. This function must be called 
and a shared key established before any other OwnerAPI JSON-RPC 
function can be called. More details: [docs.rs/grin_wallet_api/init_secure_api](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/trait.OwnerRpcS.html#tymethod.init_secure_api)

=== "Request"
    ```python
    wallet.init_secure_api()
    ```

=== "Response"
    ```json
    {
        "nonce": "ef32...",
        "body_enc": "e0bcd..."
    }
    ```

#### open_wallet()
Opens a wallet, populating the internal keychain with the encrypted seed, 
and returning a token to the caller to provide in all future calls.
More details: [docs.rs/grin_wallet_api/open_wallet](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.open_wallet)

=== "Request"
    ```python
    wallet.open_wallet()
    ```

=== "Response"
    ```json
    session_token
    ```

#### node_height()
Retrieves the last known height known by the wallet. 
More details: [docs.rs/grin_wallet_api/node_height](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.node_height)

=== "Request"
    ```python
    wallet.node_height()
    ```

=== "Response"
    ```json
    {
        "header_hash": "...",
        "height": "5",
        "updated_from_node": true
    }
    ```

#### retrieve_txs()
Returns a list of Transaction Log Entries from the active account in the wallet. 
More details: [docs.rs/grin_wallet_api/retrieve_txs](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.retrieve_txs)

=== "Request"
    ```python
    wallet.retrieve_txs()
    ```

=== "Response"
    ```json
    [
		{
		  "amount_credited": "60000000000",
		  "amount_debited": "0",
		  "confirmation_ts": "2019-01-15T16:01:26Z",
		  "confirmed": true,
		  "creation_ts": "2019-01-15T16:01:26Z",
		  "fee": null,
		  "id": 0,
		  "kernel_excess": "...",
		  "kernel_lookup_min_height": 1,
		  "messages": null,
		  "num_inputs": 0,
		  "num_outputs": 1,
		  "parent_key_id": "...",
		  "stored_tx": null,
		  "ttl_cutoff_height": null,
		  "tx_slate_id": null,
		  "payment_proof": null,
		  "tx_type": "ConfirmedCoinbase"
		},
    ]
    ```

#### retrieve_outputs()
Returns a list of outputs from the active account in the wallet. 
More details: [docs.rs/grin_wallet_api/retrieve_outputs](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.retrieve_outputs)

=== "Request"
    ```python
    wallet.retrieve_outputs()
    ```

=== "Response"
    ```json
    [
        {
            "commit": "...",
            "output": {
                "commit": "...",
                "height": "1",
                "is_coinbase": true,
                "key_id": "...",
                "lock_height": "4",
                "mmr_index": null,
                "n_child": 0,
                "root_key_id": "...",
                "status": "Unspent",
                "tx_log_entry": 0,
                "value": "60000000000"
            }
        },
    ]
    ```

#### retrieve_summary_info()
Returns summary information from the active account in the wallet.
More details: [docs.rs/grin_wallet_api/retrieve_summary_info](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.retrieve_summary_info)

=== "Request"
    ```python
    wallet.retrieve_summary_info()
    ```

=== "Response"
    ```json
    {
        "amount_awaiting_confirmation": "0",
        "amount_awaiting_finalization": "0",
        "amount_currently_spendable": "60000000000",
        "amount_immature": "180000000000",
        "amount_locked": "0",
        "last_confirmed_height": "4",
        "minimum_confirmations": "1",
        "total": "240000000000"
    }
    ```

#### cancel_tx()
Cancels a transaction. 
More details: [docs.rs/grin_wallet_api/cancel_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.cancel_tx)

=== "Request"
    ```python
    wallet.cancel_tx()
    ```

=== "Response"
    ```json
    None
    ```

#### scan()
Scans the entire UTXO set from the node, identify which outputs belong to 
the given wallet update the wallet state to be consistent with what's
currently in the UTXO set. More details: [docs.rs/grin_wallet_api/scan](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.scan)

=== "Request"
    ```python
    wallet.scan()
    ```

=== "Response"
    ```json
    None
    ```

#### finalize_tx()
Finalizes a transaction, after all parties have filled in both rounds of Slate generation. 
This step adds all participants partial signatures to create the final signature, 
resulting in a final transaction that is ready to post to a node. 
More details: [docs.rs/grin_wallet_api/finalize_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.finalize_tx)

=== "Request"
    ```python
    wallet.finalize_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### get_stored_tx()
Retrieves the stored transaction associated with a TxLogEntry. 
Can be used even after the transaction has completed. 
More details: [docs.rs/grin_wallet_api/get_stored_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.init_send_tx)

=== "Request"
    ```python
    wallet.init_send_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### init_send_tx()
Initiates a new transaction as the sender, creating a new Slate object containing the sender's inputs, 
change outputs, and public signature data. This slate can then be sent to the recipient to continue 
the transaction via the `foreign_api` `receive_tx()` method. 
More details: [docs.rs/grin_wallet_api/init_send_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.get_stored_tx)

=== "Request"
    ```python
    wallet.get_stored_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### issue_invoice_tx()
Issues a new invoice transaction slate, essentially a request for payment.
This slate can then be sent to the payer to continue 
the transaction via the `foreign_api` `finalize_invoice_tx()` method. 
More details: [docs.rs/grin_wallet_api/issue_invoice_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.issue_invoice_tx)

=== "Request"
    ```python
    wallet.issue_invoice_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### post_tx()
Posts a completed transaction to the listening node for validation and inclusion in a block for mining. 
More details: [docs.rs/grin_wallet_api/post_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.post_tx)

=== "Request"
    ```python
    wallet.post_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### process_invoice_tx()
Processes an invoice tranaction created by another party, essentially a request for payment. 
More details: [docs.rs/grin_wallet_api/process_invoice_tx](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.process_invoice_tx)

=== "Request"
    ```python
    wallet.process_invoice_tx()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### tx_lock_outputs()
Locks the outputs associated with the inputs to the transaction in the given Slate, 
making them unavailable for use in further transactions. 
More details: [docs.rs/grin_wallet_api/tx_lock_outputs](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.tx_lock_outputs)

=== "Request"
    ```python
    wallet.tx_lock_outputs()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### accounts()
Returns a list of accounts stored in the wallet.  
More details: [docs.rs/grin_wallet_api/accounts](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.accounts)

=== "Request"
    ```python
    wallet.accounts()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### change_password()
Changes a wallet's password, meaning the old seed file is decrypted with the old password, 
and a new seed file is created with the same mnemonic and encrypted with the new password. 
More details: [docs.rs/grin_wallet_api/change_password](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.close_wallet)

=== "Request"
    ```python
    wallet.close_wallet()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### close_wallet()
Close a wallet, removing the master seed from memory. 
More details: [docs.rs/grin_wallet_api/close_wallet](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.change_password)

=== "Request"
    ```python
    wallet.change_password()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### create_account_path()
Creates a new 'account', which is a mapping of a user-specified label to a BIP32 path. 
More details: [docs.rs/grin_wallet_api/create_account_path](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.create_account_path)

=== "Request"
    ```python
    wallet.create_account_path()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```

#### create_config()
Create a `epic-wallet.toml` configuration file in the `top-level` directory for the specified chain type. 
A custom WalletConfig and/or LoggingConfig may optionally be provided, otherwise defaults will be used. 
More details: [docs.rs/grin_wallet_api/create_config](https://docs.rs/grin_wallet_api/3.1.1/grin_wallet_api/struct.Owner.html#method.create_config)

=== "Request"
    ```python
    wallet.create_config()
    ```

=== "Response"
    ```json
    {'tx_data': {...}}
    ```